function dialog(e,t,i,n){var a,r,o,l=1==i?"small":2==i?"large":"full",d=e.form?e.form.id:"",c=e.tagName,s="post";if("BUTTON"==c){a=e.formAction||e.name,s=e.formMethod||s;var f=$(e.form).serialize();r=f?a.indexOf("?")==-1?a+"?"+f:a+"&"+f:a,o=" button-trig"}else"A"==c&&(a=e.href,s="get",r=a,o=" anchor-trig");n=n||e.innerHTML;var u=t==OPEN?"3.5rem":"5rem",p='<div id="dyndlg" class="'+l+" reveal"+o+'"  data-reveal data-close-on-click="false"><div class="title-bar"><div class="title-bar-title">'+n+"</div><div class=\"title-bar-right\"><a onclick=\"$('#dyndlg').foundation('close').foundation('destroy').remove(); return false;\">&times;</a></div></div><div style=\"height: -webkit-calc(100% - "+u+"); height: calc(100% - "+u+')"><iframe src="'+r+'" style="width: 100%; height: 100%; border: 0"></iframe></div>'+(t==OPEN?"":'<button class="button primary float-center" onclick="ok(this,'+t+",'"+d+"','"+c+"','"+a+"','"+s+"');\" disabled>确定</botton>")+"</div>",h=$(p);return $("body").append(h),$(h).foundation(),$(h).foundation("open"),!1}function ok(e,t,i,n,a,r){var o=$("#dyndlg");if(t==PROMPT){if(s=o.find("iframe"),f=s.contents().find("form"),0!=f.length){if(!f[0].reportValidity())return;if("A"==n)l=$(f[0]).serialize(),l&&(uri=a.indexOf("?")==-1?a+"?"+l:a+l,location.href=uri);else if("BUTTON"==n)if("get"==r){var l=$(f[0]).serialize();l&&(o.foundation("close"),o.foundation("destroy"),o.remove(),location.href=a.split("?")[0]+"?"+l)}else if("post"==r){var d=$("#"+i),c=$(f[0]).serializeArray();c.forEach(function(e,t){$("<input>").attr({type:"hidden",name:e.name,value:e.value}).appendTo(d)}),o.foundation("close"),o.foundation("destroy"),o.remove(),d.attr("action",a),d.attr("method",r),d.submit()}}}else if(t==SHOW){if(s=o.find("iframe"),f=s.contents().find("form"),0!=f.length){if(!f[0].reportValidity())return;f[0].submit()}}else if(t==OPEN){var s=o.find("iframe"),f=s.contents().find("form");if(0!=f.length&&!f[0].reportValidity())return}}function crop(e,t,i,n,a){var r="large";a=a||e.innerHTML;var o=e.href;t=t?t:120,i=i?i:120;var l='<div id="dyndlg" class="'+r+' reveal"  data-reveal data-close-on-click="false"><div class="title-bar"><div clsas="title-bar-title">'+a+'</div><div class="title-bar-right"><a onclick="$(\'#dyndlg\').foundation(\'close\').foundation(\'destroy\').remove(); return false;">&times;</a></div></div><div id="demo" style="height: -webkit-calc(100% - 8.5rem); height: calc(100% - 8.5rem); text-align: center;"><input type="file" id="fileinput" style="display: none;" onchange="bind(window.URL.createObjectURL(this.files[0]),'+t+","+i+","+n+');"><div style="text-align: center"><a class="button success hollow" onclick="$(\'#fileinput\').click();">选择图片</a><a class="button success hollow" onclick="upload(\''+o+"',"+n+');">裁剪并上传</a></div></div>',d=$(l);return $("body").append(d),$(d).foundation(),bind(o,t,i,n),$(d).foundation("open"),!1}function bind(e,t,i,n){var a=$("#demo");a.croppie("destroy"),a.croppie({url:e,viewport:{width:t,height:i,type:n?"circle":"square"},enforceBoundary:!1})}function upload(e,t){$("#demo").croppie("result",{type:"blob",size:"viewport",format:"jpeg",quality:.75,circle:t}).then(function(t){var i=new FormData;i.append("icon",t,"icon.png"),$.ajax({type:"POST",url:e,data:i,processData:!1,contentType:!1,success:function(e){alert("上传成功!")}})})}function prepay(e){var t,i="post",n=e.tagName;"BUTTON"==n?(t=e.formAction||e.name,i=e.formMethod||i):"A"==n&&(t=e.href,i="get"),$.ajax({url:t,type:"GET",dataType:"json",success:function(e){WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){"get_brand_wcpay_request:ok"==e.err_msg&&location.reload()})},error:function(e){alert("服务器访问失败")}})}function inline(e){var t=$("#container");return t.children("inline").length||(t.empty(),$("html").attr("style","height: 100%"),$("body").attr("style","height: 100%"),t.attr("style","height: -webkit-calc(100% - 8.5rem); height: calc(100% - 8.5rem)"),t.append('<iframe id="inline" style="width: 100%; height: 100%"></iframe>')),$("#inline").attr("src",e),!1}const PROMPT=2,SHOW=4,OPEN=8;