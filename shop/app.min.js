function dialog(e,t,i,a){var n,o,r,l=1==i?"small":2==i?"large":"full",d=e.form?e.form.id:"",c=e.tagName,s="post";if("BUTTON"==c){n=e.formAction||e.name,s=e.formMethod||s;var f=$(e.form).serialize();o=f?n.indexOf("?")==-1?n+"?"+f:n+"&"+f:n,r=" button-trig"}else"A"==c&&(n=e.href,s="get",o=n,r=" anchor-trig");a=a||e.innerHTML;var u=t==OPEN?"3.5rem":"5rem",v='<div id="dyndlg" class="'+l+" reveal"+r+'"  data-reveal data-close-on-click="false"><div class="title-bar"><div clsas="title-bar-title">'+a+'</div><div class="title-bar-right"><a class="close-button" href="#" onclick="$(\'#dyndlg\').foundation(\'close\').foundation(\'destroy\').remove();">&times;</a></div></div><div style="height: -webkit-calc(100% - '+u+"); height: calc(100% - "+u+')"><iframe src="'+o+'" style="width: 100%; height: 100%; border: 0"></iframe></div>'+(t==OPEN?"":'<button class="button primary float-center" onclick="ok(this,'+t+",'"+d+"','"+c+"','"+n+"','"+s+"');\" disabled>确定</botton>")+"</div>",p=$(v);return $("body").append(p),$(p).foundation(),$(p).foundation("open"),!1}function ok(e,t,i,a,n,o){var r=$("#dyndlg");if(t==PROMPT){var l=r.find("iframe"),d=l.contents().find("form");if(0!=d.length){if(!d[0].reportValidity())return;if("A"==a){var c=$(d[0]).serialize();if(c){var s=n.indexOf("?")==-1?n+"?"+c:n+c;location.href=s}}else if("BUTTON"==a)if("get"==o){var c=$(d[0]).serialize();c&&(r.foundation("close"),r.foundation("destroy"),r.remove(),location.href=n.split("?")[0]+"?"+c)}else if("post"==o){var f=$("#"+i),u=$(d[0]).serializeArray();u.forEach(function(e,t){$("<input>").attr({type:"hidden",name:e.name,value:e.value}).appendTo(f)}),r.foundation("close"),r.foundation("destroy"),r.remove(),f.attr("action",n),f.attr("method",o),f.submit()}return}}else if(t==SHOW){var l=r.find("iframe"),d=l.contents().find("form");if(0!=d.length){if(!d[0].reportValidity())return;return void d[0].submit()}}else if(t==OPEN){var l=r.find("iframe"),d=l.contents().find("form");if(0!=d.length&&!d[0].reportValidity())return}}function crop(e,t,i,a,n){var o="large";n=n||e.innerHTML;var r=e.href;t=t?t:120,i=i?i:120;var l='<div id="dyndlg" class="'+o+' reveal"  data-reveal data-close-on-click="false"><div class="title-bar"><div clsas="title-bar-title">'+n+'</div><div class="title-bar-right"><a class="close-button" href="#" onclick="$(\'#dyndlg\').foundation(\'close\').foundation(\'destroy\').remove();">&times;</a></div></div><div id="demo" style="height: -webkit-calc(100% - 8.5rem); height: calc(100% - 8.5rem); text-align: center;"><input type="file" id="fileinput" style="display: none;" onchange="bind(window.URL.createObjectURL(this.files[0]),'+t+","+i+","+a+');"><div style="text-align: center"><a class="button success hollow" onclick="$(\'#fileinput\').click();">选择图片</a><a class="button success hollow" onclick="upload(\''+r+"',"+a+');">裁剪并上传</a></div></div>',d=$(l);return $("body").append(d),$(d).foundation(),bind(r,t,i,a),$(d).foundation("open"),!1}function bind(e,t,i,a){var n=$("#demo");n.croppie("destroy"),n.croppie({url:e,viewport:{width:t,height:i,type:a?"circle":"square"},enforceBoundary:!1})}function upload(e,t){$("#demo").croppie("result",{type:"blob",size:"viewport",format:"jpeg",quality:.75,circle:t}).then(function(t){var i=new FormData;i.append("icon",t,"icon.png"),$.ajax({type:"POST",url:e,data:i,processData:!1,contentType:!1,success:function(e){alert("上传成功!")}})})}function prepay(e){var t,i="post",a=e.tagName;"BUTTON"==a?(t=e.formAction||e.name,i=e.formMethod||i):"A"==a&&(t=e.href,i="get"),$.ajax({url:t,type:"GET",dataType:"json",success:function(e){WeixinJSBridge.invoke("getBrandWCPayRequest",e,function(e){"get_brand_wcpay_request:ok"==e.err_msg&&location.reload()})},error:function(e){alert("服务器访问失败")}})}const PROMPT=2,SHOW=4,OPEN=8;