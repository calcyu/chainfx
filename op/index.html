<!DOCTYPE html>
<html>

<head>
  <title>粗粮达人</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="//cdn.bootcss.com/foundation/6.3.0/css/foundation.min.css">
  <link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <div class="row">
    <div class="small-10 columns">
      <i class="fa fa-spinner fa-spin fa-3x fa-fw"></i>
      <span class="sr-only">15公里以内</span>
    </div>
    <div class="small-2 columns float-right">
      <i class="fa fa-cart-plus fa-lg"></i>
    </div>
  </div>
  <div id="main" class="row">
  </div>
  <div class="full reveal" id="dialog" data-reveal data-close-on-click="false">
    <h3></h3>
    <button class="close-button" data-close aria-label="Close modal" type="button"><span aria-hidden="true">&times;</span></button>
    <iframe style="width: 100%; height: 80%"></iframe>
  </div>
  <script src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script>
  <script src="//cdn.bootcss.com/foundation/6.3.0/js/foundation.min.js"></script>
  <script src="/app.js"></script>
  <script>
    $(document).foundation();

    $(document).ready(function () {

      if (navigator.geolocation)

        navigator.geolocation.getCurrentPosition(function (pos) {

          var crd = pos.coords;
          var xv = crd.longitude.toString();
          var yv = crd.latitude.toString();

          // var key = getCookie('key');
          var key = '1234';

          // get shop list
          $.getJSON('/shop/lst',

            { x: xv.substring(0, xv.indexOf('.') + 2), y: yv.substring(0, yv.indexOf('.') + 2) },

            function (ret) {

              var ul = '<ul class="accordion" data-accordion>';
              ret.forEach(function (shop) {
                ul += '<li class="accordion-item" data-accordion-item>';
                ul += '<a href="#" class="accordion-title">' + shop.name + '</a>';
                ul += '<div id="' + shop.id + '" class="accordion-content" data-tab-content>';
                ul += '</div>';
                ul += '</li>';
              });
              ul += '</ul>';

              // handle accordion tab down
              var ule = $(ul).on('down.zf.accordion', function () {

                var dive = $('li.is-active > div');

                $.getJSON('/shop/' + dive.attr('id') + '/item/lst', null, function () {

                  var form = '<form action="/user/"' + key + '/';
                  ret.forEach(function (item) {
                    form += '<a href="#" class="accordion-title">' + item.name + '</a>';
                    form += '<input type="number" ' + item.id + '" class="accordion-content" data-tab-content>';
                    form += '</div>';
                  });
                  form += '</form>';

                  dive.append(form);
                });

              });

              $('#main').append(ule).foundation();

            });

        });

    });
  </script>
</body>

</html>